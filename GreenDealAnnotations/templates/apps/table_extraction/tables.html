{% extends '../../utils/base.html' %} {% load static %} {% block title %} Green Deal Annotation - Tables {% endblock %} {% block head_inject %}
<link rel="stylesheet" href="{% static 'css/timeline.css' %}" />
<link rel="stylesheet" href="{% static 'css/tables.css' %}" />
<script
    src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
    integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
    crossorigin="anonymous"
></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% endblock %} {% block main %}
<main>
    <div class="container bg-light rounded mt-2">
        <div class="row">
            <div class="col">
                <h2>Tables</h2>
                <p>
                    This page allows you to filter the tables from all European Green Deal documents by selecting different categories. In the left
                    box, the number of results is displayed at the top. Below that, you can choose one or more different categories and documents which will refine
                    the search results after clicking on the submit button.
                </p>
            </div>
        </div>
        <div class="row">
            <!----------------------------------FILTER-PANEL-------------------------------------------->
            <div class="col-4">
                <div id="Filter" class="col-md-4-de fixed-sidebar-de">
                    <div class="d-flex flex-column">
                        <div id="number_entries"></div>
                        <!--  hier werden die Container für die einzelnen Filterparts aufgesetzt
                        und die select-Optionen mit den möglichen Optionen aus der Datenbank befüllt -->
                        <label for="Category_filter">Category</label>
                        <select class="js-example-basic-multiple" id="Category_filter" onchange="get_dropdown_value()"
                                name="Category_filter" multiple="multiple">
                            {% for cat in avail_categories %}
                                <option value="{{ cat }}">{{ cat }}</option>
                            {% endfor %}
                        </select>
                        <button type="button" class="btn btn-primary" id="submit_filter" onclick="filter_url()">Submit</button>
                        <button type="button" class="btn btn-warning" id="reset" onclick="reset()">Reset</button>
                    </div>
                </div>
            </div>
            <!----------------------------------TIMELINE-------------------------------------------->
            <div class="col-8">
                <div id="timeline">
                    <ul id="dates">
                        {% for table in Tables_html %}
                        <li id="table">
                            <span class="date">
                                {{  table.Category  }}
                            </span>
                            {{ table.TableContentHTML | safe }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %} {% block footer_script %}
<script>
        $(document).ready(function () {
            $('.js-example-basic-single').select2();
            $('.js-example-basic-multiple').select2();
        });

    /********************************FILTERUNG*UND*WEITERLEITUNG***************************************/

        // Anzahl der Einträge
        document.getElementById("number_entries").textContent=("{{ Tables_html|length }}");

        // Zieht sich die ausgewählten Werte im Dropdown und schreibt sie in ein dictionary
        var filter_values = {};

        function get_dropdown_value() {
            filter_values["Category_filter"] = $(".js-example-basic-multiple").select2("val");
        }

        // Encoded die ausgewählten Filterwerte (dict) in einen str, baut eine URL
        // in der der str als Query mitgegeben wird und leitet den User auf die Seite (View) weiter
        function filter_url(){

            var str = [];
            for(var p in filter_values){
               str.push(encodeURIComponent(p) + "=" + encodeURIComponent(filter_values[p]));
            }

            str = "?" + str.join("&") + "#timeline"; // & will be converted to %2C in url
            window.location = str;
        }

        // Reset Button, löscht die ausgewählten Filter und die Werte aus dem Dictionary,
        // leitet anschließend auf die Seite (View) mit den ungefilterten Daten
        function reset(){
            window.location = "?Category_filter=#timeline"
        }
</script>
{% endblock %}
