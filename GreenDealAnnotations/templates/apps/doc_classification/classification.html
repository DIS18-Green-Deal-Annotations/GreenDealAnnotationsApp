{% extends '../../utils/base.html' %}
{% load static %}

{% block title %}
    Green Deal Annotation - Classification
{% endblock %}

{% block head_inject %}
    <link rel="stylesheet" href="{% static 'css/timeline.css' %}">
    <link rel="stylesheet" href="{% static 'css/classifcation.css' %}">

    <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
            integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% endblock %}

{% block main %}
    <main>
        <div class="container bg-light rounded mt-2">
            <div class="row">
                <div class="col">
                    <h2>Classification</h2>
                    <p>
                        In order to analyse the documents of the Green Deal Project contentual descriptors can be
                        accessed through the module.<br>
                        By selecting one of the descriptors the corresponding data will be displayed.
                    </p>
                </div>
            </div>
            <!-----------------------------------FILTER-PANEL------------------------------------------->
            <div class="row">
                <div class="col-4">
                    <div id="Filter" class="col-md-4-de fixed-sidebar-de">
                        <div class="d-flex flex-column">
                            <label for="doc_name">Descriptors found:</label>
                            <div id="number_entries"></div>
                            <!--  hier werden die Container für die einzelnen Filterparts aufgesetzt
                            und die select-Optionen mit den möglichen Optionen aus der Datenbank befüllt -->

                            <select class="js-example-basic-single" id="doc_name" onchange="get_dropdown_value()"
                                    name="doc_name">
                                {% for doc in descriptor_filter %}
                                    <option value="{{ doc }}">{{ doc }}</option>
                                {% endfor %}
                            </select>

                            <button type="button" class="btn btn-primary" id="submit_filter" onclick="filter_url()">
                                Submit
                            </button>
                            <button type="button" class="btn btn-warning" id="reset" onclick="reset()"> Reset</button>
                        </div>
                    </div>
                </div>
                <!-----------------------------------TIMELINE------------------------------------------->
                <div class="col-8">
                    <div style="overflow-x:scroll;width:100%;">
                        <table class="table">
                            <tr>
                                <th class="document-classification-td">Nr.</th>
                                <th class="document-classification-td">Body</th>
                                <th class="document-classification-td">descriptors</th>
                                <th class="document-classification-td">structure</th>
                            </tr>
                            {% for col in data2 %}
                                <tr>
                                    <td class="document-classification-td">{{ col.comnumber_id }}</td>
                                    <td class="document-classification-td">{{ col.cleanbody }}</td>
                                    <td class="document-classification-td">{{ col.deskriptor }}</td>
                                    <td class="document-classification-td">{{ col.structure }}</td>
                                </tr>
                            {% endfor %}

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

{% block footer_script %}
    <script>
        $(document).ready(function () {
            $('.js-example-basic-single').select2();
            $('.js-example-basic-multiple').select2();
        });

        /********************************FILTERUNG*UND*WEITERLEITUNG***************************************/

        // Anzahl der Einträge
        document.getElementById("number_entries").textContent = ("{{ length_descriptors }}");

        /// if schleife falls leer ersten eintrag !!!!!!!!!
        document.getElementById("doc_name").value = ("{{ desk2 }}");

        // Zieht sich die ausgewählten Werte im Dropdown und schreibt sie in ein dictionary
        var filter_values = {};

        function get_dropdown_value() {

            filter_values["descriptor"] = $(".js-example-basic-single").select2("val");

        }

        // Encoded die ausgewählten Filterwerte (dict) in einen str, baut eine URL
        // in der der str als Query mitgegeben wird und leitet den User auf die Seite (View) weiter
        function filter_url() {

            var str = [];
            for (var p in filter_values) {
                str.push(encodeURIComponent(p) + "=" + encodeURIComponent(filter_values[p]));
            }

            str = "?" + str.join("&") + "#classification";
            window.location = str;
        }

        // Reset Button, löscht die ausgewählten Filter und die Werte aus dem Dictionary,
        // leitet anschließend auf die Seite (View) mit den ungefilterten Daten
        function reset() {
            window.location = "?descriptor=#classification"
        }
    </script>
{% endblock %}
